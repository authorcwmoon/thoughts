_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[64],{Cpyz:function(e,a,t){"use strict";t.r(a),t.d(a,"frontMatter",(function(){return m})),t.d(a,"default",(function(){return N}));var n=t("wx14"),c=t("Ff2n"),s=t("q1tI"),o=t.n(s),p=t("7ljp"),b=t("ZDfL"),r=t("l589"),m=(o.a.createElement,{title:"Using the Spotify API with Next.js",publishedAt:"2020-07-21",summary:"Learn how to authenticate with the Spotify API to fetch your top tracks in a Next.js API route.",image:"/static/images/spotify-api-nextjs/banner.png",wordCount:693,readingTime:{text:"4 min read",minutes:3.455,time:207300,words:691},__resourcePath:"blog/spotify-api-nextjs.mdx",__scans:{},layout:"index"}),j={frontMatter:m},O=b.a;function N(e){var a=e.components,t=Object(c.a)(e,["components"]);return Object(p.b)(O,Object(n.a)({},j,t,{components:a,mdxType:"MDXLayout"}),Object(p.b)("p",null,"One of my favorite parts of my website is my ",Object(p.b)("a",Object(n.a)({parentName:"p"},{href:"/dashboard"}),"dashboard"),".\nIt's a fun, unique way for me to showcase various metrics about my life.\nIt's also a playground for experimenting with new technology and APIs.\nIt currently has integrations with YouTube, Unsplash, Firebase, Buttondown, GitHub, Gumroad, and now Spotify!"),Object(p.b)("p",null,"I wanted to display what song I'm currently listening to, as well as my top tracks.\nTo accomplish this, I'd need to integrate ",Object(p.b)("a",Object(n.a)({parentName:"p"},{href:"https://developer.spotify.com/documentation/web-api/"}),"Spotify's API")," with Next.js ",Object(p.b)("a",Object(n.a)({parentName:"p"},{href:"https://nextjs.org/docs/api-routes/introduction"}),"API routes"),".\nThis post will be a quick tutorial to get up and running with Spotify."),Object(p.b)("h2",{id:"create-an-application"},"Create an Application"),Object(p.b)("p",null,"First, we need to create a Spotify application to give us credentials to authenticate with the API."),Object(p.b)("ul",null,Object(p.b)("li",{parentName:"ul"},"Go to your ",Object(p.b)("a",Object(n.a)({parentName:"li"},{href:"https://developer.spotify.com/dashboard/"}),"Spotify Developer Dashboard")," and log in."),Object(p.b)("li",{parentName:"ul"},"Click ",Object(p.b)("strong",{parentName:"li"},"Create an App"),"."),Object(p.b)("li",{parentName:"ul"},"Fill out the name and description and click ",Object(p.b)("strong",{parentName:"li"},"create"),"."),Object(p.b)("li",{parentName:"ul"},"Click ",Object(p.b)("strong",{parentName:"li"},"Show Client Secret"),"."),Object(p.b)("li",{parentName:"ul"},"Save your Client ID and Secret. You'll need these soon."),Object(p.b)("li",{parentName:"ul"},"Click ",Object(p.b)("strong",{parentName:"li"},"Edit Settings"),"."),Object(p.b)("li",{parentName:"ul"},"Add ",Object(p.b)("inlineCode",{parentName:"li"},"http://localhost:3000")," as a redirect URI.")),Object(p.b)("p",null,"All done! You now have a properly configured Spotify application and the correct credentials to make requests."),Object(p.b)("h2",{id:"authentication"},"Authentication"),Object(p.b)("p",null,"There are a variety of ways to authenticate with the Spotify API, depending on your application. Since we only need permission granted ",Object(p.b)("em",{parentName:"p"},"once"),", we'll use the ",Object(p.b)("a",Object(n.a)({parentName:"p"},{href:"https://developer.spotify.com/documentation/general/guides/authorization-guide/#authorization-code-flow"}),"Authorization Code Flow"),"."),Object(p.b)("p",null,"First, we'll have our application request authorization by logging in with whatever ",Object(p.b)("a",Object(n.a)({parentName:"p"},{href:"https://developer.spotify.com/documentation/general/guides/authorization-guide/#list-of-scopes"}),"scopes")," we need.\nHere's an example of what the URL might look like.\nSwap out the ",Object(p.b)("inlineCode",{parentName:"p"},"client_id")," and scopes for your own."),Object(p.b)("pre",{className:"language-bash"},Object(p.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"https://accounts.spotify.com/authorize?client_id",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"="),"8e94bde7dd\nb84a1f7a0e51bf3bc95be8",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"&"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token assign-left variable"}),"response_type"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"="),"code",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"&"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token assign-left variable"}),"redirect_uri"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"="),"http\n%3A%2F%2Flocalhost:3000",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"&"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token assign-left variable"}),"scope"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"="),"user-read-currently-playing%20\nuser-top-read\n")),Object(p.b)("p",null,"After authorizing, you'll be redirected back to your ",Object(p.b)("inlineCode",{parentName:"p"},"redirect_uri"),".\nIn the URL, there's a ",Object(p.b)("inlineCode",{parentName:"p"},"code")," query parameter. Save this value."),Object(p.b)("pre",{className:"language-bash"},Object(p.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"http://localhost:3000/callback?code",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"="),"NApCCg",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),".."),"BkWtQ\n")),Object(p.b)("p",null,"Next, we'll need to retrieve the refresh token. You'll need to generate a Base 64 encoded string containing the client ID and secret from earlier. You can use ",Object(p.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.base64encode.org/"}),"this tool")," to encode it online. The format should be ",Object(p.b)("inlineCode",{parentName:"p"},"client_id:client_secret"),"."),Object(p.b)("pre",{className:"language-bash"},Object(p.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"curl")," -H ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"Authorization: Basic <base64 encoded client_id:client_secret>"'),"\n-d ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token assign-left variable"}),"grant_type"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"="),"authorization_code -d ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token assign-left variable"}),"code"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"="),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"<"),"code",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),">")," -d ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token assign-left variable"}),"redirect_uri"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"="),"http%3A\n%2F%2Flocalhost:3000 https://accounts.spotify.com/api/token\n")),Object(p.b)("p",null,"This will return a JSON response containing a ",Object(p.b)("inlineCode",{parentName:"p"},"refresh_token"),". This token is ",Object(p.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/spotify/web-api/issues/374"}),"valid indefinitely")," unless you revoke access, so we'll want to save this in an environment variable."),Object(p.b)("h2",{id:"using-spotifys-api"},"Using Spotify's API"),Object(p.b)("p",null,"Finally, we can get some real data! Inside Next.js, create three new values in your ",Object(p.b)("inlineCode",{parentName:"p"},".env.local")," file."),Object(p.b)("pre",{className:"language-bash"},Object(p.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token assign-left variable"}),"SPOTIFY_CLIENT_ID"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"="),"\n",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token assign-left variable"}),"SPOTIFY_CLIENT_SECRET"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"="),"\n",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token assign-left variable"}),"SPOTIFY_REFRESH_TOKEN"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"="),"\n")),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"Note:")," If you haven't worked with environment variables in Next before, ",Object(p.b)("a",Object(n.a)({parentName:"p"},{href:"https://nextjs.org/docs/basic-features/environment-variables"}),"give this a read first"),"."),Object(p.b)("p",null,"We can now request an access token using our client ID, client secret, and ",Object(p.b)("inlineCode",{parentName:"p"},"refresh_token"),"."),Object(p.b)("div",{className:"remark-code-title"},"lib/spotify.js"),Object(p.b)("pre",{className:"language-js"},Object(p.b)("code",Object(n.a)({parentName:"pre"},{className:"language-js"}),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"import")," querystring ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"from")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'querystring'"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token constant"}),"SPOTIFY_CLIENT_ID"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," client_id",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n  ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token constant"}),"SPOTIFY_CLIENT_SECRET"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," client_secret",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n  ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token constant"}),"SPOTIFY_REFRESH_TOKEN"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," refresh_token\n",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," process",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"env"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," basic ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token maybe-class-name"}),"Buffer"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"from"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token template-string"}),Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token template-punctuation string"}),"`"),Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation"}),Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation-punctuation punctuation"}),"${"),"client_id",Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation-punctuation punctuation"}),"}")),Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token string"}),":"),Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation"}),Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation-punctuation punctuation"}),"${"),"client_secret",Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation-punctuation punctuation"}),"}")),Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token template-punctuation string"}),"`")),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"toString"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'base64'"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token constant"}),"TOKEN_ENDPOINT")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token template-string"}),Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token template-punctuation string"}),"`"),Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token string"}),"https://accounts.spotify.com/api/token"),Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token template-punctuation string"}),"`")),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token function-variable function"}),"getAccessToken")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"async")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," response ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"await")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"fetch"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token constant"}),"TOKEN_ENDPOINT"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    method",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'POST'"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n    headers",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token maybe-class-name"}),"Authorization"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token template-string"}),Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token template-punctuation string"}),"`"),Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token string"}),"Basic "),Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation"}),Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation-punctuation punctuation"}),"${"),"basic",Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation-punctuation punctuation"}),"}")),Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token template-punctuation string"}),"`")),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n      ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'Content-Type'"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'application/x-www-form-urlencoded'"),"\n    ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n    body",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," querystring",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"stringify"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      grant_type",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'refresh_token'"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n      refresh_token\n    ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),"\n  ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," response",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"json"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n")),Object(p.b)("p",null,"Use this ",Object(p.b)("inlineCode",{parentName:"p"},"access_token")," to securely request your top tracks.\nThis assumes you added the ",Object(p.b)("inlineCode",{parentName:"p"},"user-top-read")," scope at the beginning."),Object(p.b)("div",{className:"remark-code-title"},"lib/spotify.js"),Object(p.b)("pre",{className:"language-js"},Object(p.b)("code",Object(n.a)({parentName:"pre"},{className:"language-js"}),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token constant"}),"TOP_TRACKS_ENDPOINT")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token template-string"}),Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token template-punctuation string"}),"`"),Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token string"}),"https://api.spotify.com/v1/me/top/tracks"),Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token template-punctuation string"}),"`")),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"export")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token function-variable function"}),"getTopTracks")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"async")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," access_token ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"await")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"getAccessToken"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"fetch"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token constant"}),"TOP_TRACKS_ENDPOINT"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    headers",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token maybe-class-name"}),"Authorization"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token template-string"}),Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token template-punctuation string"}),"`"),Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token string"}),"Bearer "),Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation"}),Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation-punctuation punctuation"}),"${"),"access_token",Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation-punctuation punctuation"}),"}")),Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token template-punctuation string"}),"`")),"\n    ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n")),Object(p.b)("h3",{id:"creating-an-api-route"},"Creating an API Route"),Object(p.b)("p",null,"Let's test our communication with Spotify.\nFirst, create a new file at ",Object(p.b)("inlineCode",{parentName:"p"},"pages/api/top-tracks.js"),".\nThen, import the new function ",Object(p.b)("inlineCode",{parentName:"p"},"getTopTracks"),"."),Object(p.b)("div",{className:"remark-code-title"},"pages/api/top-tracks.js"),Object(p.b)("pre",{className:"language-js"},Object(p.b)("code",Object(n.a)({parentName:"pre"},{className:"language-js"}),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"import")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," getTopTracks ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"from")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'../../lib/spotify'"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"export")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"default")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"async")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token parameter"}),"_",Object(p.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),",")," res"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," response ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"await")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"getTopTracks"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," items ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"await")," response",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"json"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," tracks ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," items",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"slice"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"0"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"10"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"map"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token parameter"}),"track"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    artist",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," track",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"artists"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"map"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token parameter"}),"_artist"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," _artist",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"name"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"join"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"', '"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n    songUrl",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," track",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"external_urls"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"spotify"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n    title",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," track",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"name"),"\n  ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," res",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"status"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"200"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"json"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," tracks ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n")),Object(p.b)("p",null,"This will return the first ten top tracks, formatted to remove unnecessary information.\nFeel free to modify this as you see fit.\nIf everything worked correctly, you should see some data like this after running ",Object(p.b)("inlineCode",{parentName:"p"},"next dev"),"."),Object(p.b)("pre",{className:"language-json"},Object(p.b)("code",Object(n.a)({parentName:"pre"},{className:"language-json"}),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// https://leerob.io/api/top-tracks"),"\n\n",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"tracks"'),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"["),"\n    ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"artist"'),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"Jamie xx"'),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n      ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"songUrl"'),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"https://open.spotify.com/track/77Ezu3tBE7gmzQ4mRnZZUf"'),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n      ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"title"'),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"The Rest Is Noise"'),"\n    ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n    ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"artist"'),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"Surfaces"'),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n      ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"songUrl"'),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"https://open.spotify.com/track/0NjSiGW8b5HYFfjdCbZzbg"'),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n      ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"title"'),Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"Horizons"'),"\n    ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n",Object(p.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(p.b)("h2",{id:"example"},"Example"),Object(p.b)("p",null,"Here are my top tracks, also shown on my ",Object(p.b)("a",Object(n.a)({parentName:"p"},{href:"/dashboard"}),"dashboard"),".\nYou can view the source code ",Object(p.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/leerob/leerob.io/blob/master/lib/spotify.js"}),"here"),"."),Object(p.b)(r.a,{mdxType:"TopTracks"}))}N.isMDXComponent=!0},hTpv:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/spotify-api-nextjs",function(){return t("Cpyz")}])},l589:function(e,a,t){"use strict";var n=t("wx14"),c=t("q1tI"),s=t.n(c),o=t("VtrM"),p=t("QtGK"),b=t("mf32"),r=t("BMxC"),m=t("sK1y"),j=t("Yn+B"),O=t("pboS"),N=s.a.createElement,i=function(e){var a=Object(b.b)().colorMode;return N(r.a,{mb:4,display:"flex",flexDirection:"row",alignItems:"baseline",borderBottom:"1px solid",borderColor:{light:"gray.100",dark:"gray.800"}[a],p:2,maxWidth:"600px",w:"full"},N(m.a,{fontSize:"sm",fontWeight:"bold",color:{light:"gray.400",dark:"gray.600"}[a]},e.ranking),N(j.a,{spacing:0,ml:3},N(O.a,{fontWeight:"medium",maxWidth:"600px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",href:e.songUrl,isExternal:!0},e.title),N(m.a,{color:"gray.500",mb:4,maxWidth:"600px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},e.artist)))},l=s.a.createElement;a.a=function(){var e=Object(o.a)("/api/top-tracks",p.a).data;return e?e.tracks.map((function(e,a){return l(i,Object(n.a)({ranking:a+1,key:e.songUrl},e))})):null}}},[["hTpv",1,2,0,3,4,5,6,7,8]]]);