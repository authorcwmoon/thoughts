_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[56],{NVvP:function(e,a,t){"use strict";t.r(a),t.d(a,"frontMatter",(function(){return m})),t.d(a,"default",(function(){return O}));var n=t("wx14"),c=t("Ff2n"),s=t("q1tI"),o=t.n(s),b=t("7ljp"),p=t("ZDfL"),r=t("qh8W"),m=(o.a.createElement,{title:"Going Serverless with Next.js and Firebase",publishedAt:"2019-07-19",summary:"Learn how to build a serverless application with Next.js, Firebase, Cloud Firestore, and easily deploy it with Vercel.",image:"/static/images/nextjs-firebase-serverless/banner.jpg",wordCount:915,readingTime:{text:"5 min read",minutes:4.565,time:273900.00000000006,words:913},__resourcePath:"blog/nextjs-firebase-serverless.mdx",__scans:{},layout:"index"}),i={frontMatter:m},j=p.a;function O(e){var a=e.components,t=Object(c.a)(e,["components"]);return Object(b.b)(j,Object(n.a)({},i,t,{components:a,mdxType:"MDXLayout"}),Object(b.b)("p",null,Object(b.b)("img",Object(n.a)({parentName:"p"},{src:"/static/images/nextjs-firebase-serverless/banner.png",alt:"Next.js + Firebase + Vercel"}))),Object(b.b)("p",null,'A critical step in freelance development is assessing your client\'s business problem and finding the best technology to solve it. "Best" could mean a variety of things depending on the client: cheap, fast, robust, future-proof, or industry standard. This post will outline how I assessed a business problem, chose the "best" technology, and delivered a timely solution to my client.'),Object(b.b)("p",null,Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://beyondhq.co/"}),"BeyondHQ"),' is an early-stage startup that helps companies expand outside of San Francisco. Think "Expansion-as-a-Service" - finding the right city, opening an office, growing your team, etc. They needed a basic website explaining who, what, and why - as well as a platform to build their SaaS solutions on top of. That\'s where I came in.'),Object(b.b)("h2",{id:"the-requirements"},"The Requirements"),Object(b.b)("p",null,"For the main website, the requirements were fairly straight forward:"),Object(b.b)("ul",null,Object(b.b)("li",{parentName:"ul"},"Basic splash page with information about the product."),Object(b.b)("li",{parentName:"ul"},"About page with information on the employees."),Object(b.b)("li",{parentName:"ul"},"Frequently asked questions page."),Object(b.b)("li",{parentName:"ul"},"Save off information from a contact form."),Object(b.b)("li",{parentName:"ul"},"Cheap hosting. Ideally free.")),Object(b.b)("p",null,Object(b.b)("img",Object(n.a)({parentName:"p"},{src:"/static/images/nextjs-firebase-serverless/landing.png",alt:"BeyondHQ"}))),Object(b.b)("p",null,"They also wanted a platform to build SaaS on. That meant I needed to consider more requirements, as it would be the next bit of functionality I would create."),Object(b.b)("p",null,"The first step towards their full-featured SaaS product was a ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://beyondhq.co/geo-eval"}),"location evaluation tool"),". Users could enter information like their company size, the number of employees, and potential expansion locations to get a list of their top city matches. Then, they could explore each city and see metrics about what made it an attractive option to expand to. Those requirements were a bit more complex:"),Object(b.b)("ul",null,Object(b.b)("li",{parentName:"ul"},"Resilient, highly available, and fast."),Object(b.b)("li",{parentName:"ul"},"Cheap storage. Ideally free."),Object(b.b)("li",{parentName:"ul"},"Great SEO (Search Engine Optimization)."),Object(b.b)("li",{parentName:"ul"},"City pages should be dynamic and pull from a database."),Object(b.b)("li",{parentName:"ul"},"The ability for non-technical people to easily edit data."),Object(b.b)("li",{parentName:"ul"},"Save off lead generation information from user input.")),Object(b.b)("p",null,Object(b.b)("img",Object(n.a)({parentName:"p"},{src:"/static/images/nextjs-firebase-serverless/questions.png",alt:"BeyondHQ"}))),Object(b.b)("h2",{id:"the-technology"},"The Technology"),Object(b.b)("p",null,"Given these requirements, what technical choices did I make and why? Let's take a look."),Object(b.b)("h3",{id:"react"},"React"),Object(b.b)("p",null,Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://reactjs.org/"}),"React")," is the industry-standard for building modern web applications. Of 90,000 developers ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://insights.stackoverflow.com/survey/2019"}),"surveyed by Stack Overflow"),", React was the most loved and most wanted. This technology provides a platform for the main website, as well as any future SaaS."),Object(b.b)("h3",{id:"nextjs"},"Next.JS"),Object(b.b)("p",null,Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://nextjs.org/"}),"Next.js")," makes it easy to build scalable, performant React code. It's blazing fast and uses server-side rendering to improve SEO. On top of that, it simplifies the developer experience and provides a future-proof platform for the BeyondHQ team."),Object(b.b)("h3",{id:"vercel"},"Vercel"),Object(b.b)("p",null,"Deploying serverless applications couldn't be easier with ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://vercel.com"}),"Vercel"),". It's resilient, ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://vercel.com/smart-cdn"}),"highly available"),", and fault-tolerant. Plus, it has an excellent ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://vercel.com/pricing"}),"free tier")," with the ability to scale as needed."),Object(b.b)("h3",{id:"firebase"},"Firebase"),Object(b.b)("p",null,Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://firebase.google.com/"}),"Firebase")," is the industry standard ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://en.wikipedia.org/wiki/NoSQL"}),"NoSQL")," platform. It has a sufficient user/permissions system and an easy interface for non-technical users. Did it mention it has a generous ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://firebase.google.com/pricing"}),"free tier"),"? Firebase's ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://firebase.google.com/products/firestore/"}),"Cloud Firestore")," product allowed us to save off contact info, city information, and user's lead gen input. It was a no-brainer!"),Object(b.b)("p",null,"Why use NoSQL? There weren't any requirements which needed a relational database. If there were, I might have considered ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://hasura.io/"}),"Postgres on Hasura")," instead."),Object(b.b)("h2",{id:"the-solution"},"The Solution"),Object(b.b)("p",null,"After reviewing the requirements and choosing the technology, the next step was to begin implementing a solution. But first, mockups!"),Object(b.b)("p",null,Object(b.b)("img",Object(n.a)({parentName:"p"},{src:"/static/images/nextjs-firebase-serverless/geo-eval.png",alt:"BeyondHQ"}))),Object(b.b)("p",null,"I iterated over a handful of designs and went back and forth with the team, tweaking things based on their feedback. We eventually agreed on a mockup and the coding commenced."),Object(b.b)("h3",{id:"api-route"},"API Route"),Object(b.b)("p",null,"To use Firebase, we need to create an ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://nextjs.org/docs/api-routes/introduction"}),"API route"),".\nThis will allow us to use ",Object(b.b)("inlineCode",{parentName:"p"},"firebase-admin")," to communicate with our Cloud Firestore database."),Object(b.b)("p",null,Object(b.b)("strong",{parentName:"p"},"Note:")," You need to generate and download a service account in Firebase."),Object(b.b)("div",{className:"remark-code-title"},"lib/firebase.js"),Object(b.b)("pre",{className:"language-js"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-js"}),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"import")," admin ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"from")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'firebase-admin'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"try")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  admin",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"initializeApp"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    credential",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," admin",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"credential"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"cert"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      project_id",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," process",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"env"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token constant"}),"FIREBASE_PROJECT_ID"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n      private_key",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," process",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"env"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token constant"}),"FIREBASE_PRIVATE_KEY"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n      client_email",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," process",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"env"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token constant"}),"FIREBASE_CLIENT_EMAIL"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n    databaseURL",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'https://vercel-serverless.firebaseio.com'"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"catch")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"error",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),'/*\n   * We skip the "already exists" message which is\n   * not an actual error when we\'re hot-reloading.\n   */'),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"if")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"!"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token regex"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token regex-delimiter"}),"/"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token language-regex"}),"already exists"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token regex-delimiter"}),"/"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token regex-flags"}),"u")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"test"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"error",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"message"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// eslint-disable-next-line no-console"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token console class-name"}),"console"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"error"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'Firebase admin initialization error'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," error",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"stack"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"export")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"default")," admin",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"firestore"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n")),Object(b.b)("div",{className:"remark-code-title"},"pages/api/city/[name].js"),Object(b.b)("pre",{className:"language-js"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-js"}),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"import")," firebase ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"from")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'../../../lib/firebase'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"export")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"default")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token parameter"}),"req",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),",")," res"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  firebase\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"collection"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'cities'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"doc"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"req",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"query"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"name"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"get"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"then"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token parameter"}),"doc"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      res",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"json"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"doc",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"data"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"catch"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token parameter"}),"error"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      res",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"json"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," error ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n")),Object(b.b)("p",null,"Let's break this down."),Object(b.b)("ul",null,Object(b.b)("li",{parentName:"ul"},"A request is made to ",Object(b.b)("inlineCode",{parentName:"li"},"/api/city/des-moines")),Object(b.b)("li",{parentName:"ul"},"A connection to Firestore is created with your service account"),Object(b.b)("li",{parentName:"ul"},"We query the ",Object(b.b)("inlineCode",{parentName:"li"},"cities")," collection"),Object(b.b)("li",{parentName:"ul"},Object(b.b)("inlineCode",{parentName:"li"},"req.query.name")," has the ",Object(b.b)("a",Object(n.a)({parentName:"li"},{href:"https://nextjs.org/docs/routing/dynamic-routes"}),"dynamic route")," value of ",Object(b.b)("inlineCode",{parentName:"li"},"des-moines")),Object(b.b)("li",{parentName:"ul"},"We return the data for that document")),Object(b.b)("h3",{id:"the-client"},"The Client"),Object(b.b)("p",null,"For each city, we want to pass the name as a route (e.g. ",Object(b.b)("inlineCode",{parentName:"p"},"/city/des-moines"),") and fetch data from our API.\nLet's create ",Object(b.b)("inlineCode",{parentName:"p"},"pages/city/[name].js")," using ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://nextjs.org/docs/routing/dynamic-routes"}),"dynamic routing")," and ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"/blog/fetching-data-with-swr"}),"SWR"),"."),Object(b.b)("div",{className:"remark-code-title"},"/pages/city/[name].js"),Object(b.b)("pre",{className:"language-js"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-js"}),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"import")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," useRouter ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"from")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'next/router'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"import")," useSWR ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"from")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'swr'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function-variable function"}),"fetcher")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"async")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token parameter"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token spread operator"}),"..."),"args"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," res ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"await")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"fetch"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token spread operator"}),"..."),"args",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," res",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"json"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"function")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token maybe-class-name"}),"City")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," router ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"useRouter"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," name ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," router",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"query"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," data ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"useSWR"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token template-string"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token template-punctuation string"}),"`"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token string"}),"/api/city/"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation-punctuation punctuation"}),"${"),"name",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation-punctuation punctuation"}),"}")),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token template-punctuation string"}),"`")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," fetcher",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"if")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"!"),"data",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'Loading...'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"<"),"div",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),">"),"\n      ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"<"),"p",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),">"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token maybe-class-name"}),"Population"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"data",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"population"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"<"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"/"),"p",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),">"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"<"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"/"),"div",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),">"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"export")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"default")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token maybe-class-name"}),"City"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n")),Object(b.b)("p",null,"This gives you the flexibility to add a loading state or placeholder to improve your user experience."),Object(b.b)("p",null,Object(b.b)("img",Object(n.a)({parentName:"p"},{src:"/static/images/nextjs-firebase-serverless/loading.gif",alt:"Loading Placeholder"}))),Object(b.b)("p",null,"Much better! \ud83c\udf89"),Object(b.b)("h2",{id:"conclusion"},"Conclusion"),Object(b.b)("p",null,"If you find yourself with similar requirements, you can now consider using this stack to provide an elegant solution.\nYou can view the ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/leerob/nextjs-vercel-firebase"}),"source code here"),"."),Object(b.b)(r.a,{title:"React 2025",description:"Build and deploy a modern Jamstack application using the most popular open-source software.",href:"https://react2025.com/",icon:"react2025",mdxType:"ProjectCard"}))}O.isMDXComponent=!0},qh8W:function(e,a,t){"use strict";var n=t("q1tI"),c=t.n(n),s=t("hyUy"),o=t("mf32"),b=t("pboS"),p=t("Weur"),r=t("w0db"),m=t("Yn+B"),i=t("qWyU"),j=t("sK1y"),O=c.a.createElement;a.a=function(e){var a=e.title,t=e.description,n=e.href,c=e.icon,l=Object(o.b)().colorMode;return O(b.a,{mb:4,href:n,onClick:function(){return function(e){s.b({"React 2025":"5WGDOKV0","Mastering Next.js":"HV9HDL0O",jamstackfns:"LRXBPLZS"}[e],0)}(a)},title:a,isExternal:!0,_hover:{boxShadow:"0px 4px 20px rgba(0, 0, 0, 0.05)",textDecoration:"none"}},O(p.a,{align:"center",border:"1px solid",borderColor:{light:"gray.200",dark:"gray.600"}[l],borderRadius:4,p:4},O(r.a,{"aria-label":"LinkedIn",name:c,color:{light:"gray.1000",dark:"white"}[l],size:"32px",ml:2,mr:4}),O(m.a,null,O(i.a,{as:"h4",size:"md",fontWeight:"bold",mb:4,letterSpacing:"tighter"},a),O(j.a,{lineHeight:"1.3"},t))))}},xQf0:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/nextjs-firebase-serverless",function(){return t("NVvP")}])}},[["xQf0",1,2,0,3,4,5,6,7,8]]]);