_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[55],{"3BsH":function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/nextjs-authentication",function(){return t("qvcl")}])},qvcl:function(e,a,t){"use strict";t.r(a),t.d(a,"frontMatter",(function(){return r})),t.d(a,"default",(function(){return O}));var n=t("wx14"),c=t("Ff2n"),s=t("q1tI"),o=t.n(s),b=t("7ljp"),p=t("ZDfL"),r=(o.a.createElement,{title:"Authentication Patterns for Next.js",publishedAt:"2020-08-17",summary:"Learn how to add authentication with Next.js. The guide covers custom React Hooks, protecting routes and redirecting on the server, and includes a variety of examples.",image:"/static/images/nextjs-authentication/banner.png",wordCount:1421,readingTime:{text:"8 min read",minutes:7.095,time:425700,words:1419},__resourcePath:"blog/nextjs-authentication.mdx",__scans:{},layout:"index"}),m={frontMatter:r},j=p.a;function O(e){var a=e.components,t=Object(c.a)(e,["components"]);return Object(b.b)(j,Object(n.a)({},m,t,{components:a,mdxType:"MDXLayout"}),Object(b.b)("p",null,"Authentication verifies who a user is, while authorization controls what a user can access. Next.js supports multiple patterns for authentication, each designed for different use cases. This guide will allow you to choose your adventure based on your constraints."),Object(b.b)("h2",{id:"authentication-patterns"},"Authentication Patterns"),Object(b.b)("p",null,"The first step to identifying which authentication pattern you need is understanding the data-fetching strategy you want. We can then determine which authentication providers support this strategy. There are two main strategies:"),Object(b.b)("ul",null,Object(b.b)("li",{parentName:"ul"},"Use static generation to server-render a loading state, followed by fetching user data client-side."),Object(b.b)("li",{parentName:"ul"},"Fetch user data server-side to eliminate a flash of unauthenticated content.")),Object(b.b)("h3",{id:"static-generation"},"Static Generation"),Object(b.b)("p",null,"Next.js automatically determines that a page is static if there are no blocking data requirements. This means the absence of ",Object(b.b)("inlineCode",{parentName:"p"},"getServerSideProps")," and ",Object(b.b)("inlineCode",{parentName:"p"},"getInitialProps")," in the page. Instead, your page can render a loading state from the server, followed by fetching the user client-side."),Object(b.b)("p",null,"One advantage of this pattern is it allows pages to be served from a global CDN and ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://nextjs.org/docs/api-reference/next/link"}),"preloaded")," using ",Object(b.b)("inlineCode",{parentName:"p"},"<Link />"),". Depending on the size of your application, ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://reactjs.org/docs/react-dom.html#hydrate"}),"React hydration")," could take some time. If you serve a loading shell from the server, this allows React to hydrate while you're fetching user data. In practice, this results in a faster TTI (",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://web.dev/interactive/"}),"Time to Interactive"),")."),Object(b.b)("p",null,"Let's look at an example for a profile page. This will initially render a loading skeleton. Once the request for a user has finished, it will show the user's name."),Object(b.b)("div",{className:"remark-code-title"},"pages/profile.js"),Object(b.b)("pre",{className:"language-jsx"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-jsx"}),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"export")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"default")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function-variable function"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token maybe-class-name"}),"Profile"))," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// Fetch the user client-side"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," user ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"useUser"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," redirectTo",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'/login'")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// Server-render loading skeleton"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"if")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"!"),"user",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"<"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token class-name"}),"LoadingSkeleton"))," ",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"/>")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// Once the user request finishes, show the user's name"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"<"),"p"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),">")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"user",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"name"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"</"),"p"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),">")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n")),Object(b.b)("h3",{id:"server-side-rendering"},"Server-Side Rendering"),Object(b.b)("p",null,"If you export an ",Object(b.b)("inlineCode",{parentName:"p"},"async")," function called ",Object(b.b)("inlineCode",{parentName:"p"},"getServerSideProps")," from a page, Next.js will pre-render this page on each request using the data returned by ",Object(b.b)("inlineCode",{parentName:"p"},"getServerSideProps"),"."),Object(b.b)("pre",{className:"language-jsx"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-jsx"}),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"export")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"async")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"function")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"getServerSideProps"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token parameter"}),"context"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    props",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// Will be passed to the page component as props"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(b.b)("p",null,"Let's transform the profile example from earlier to use server-side rendering. If there's a session, return ",Object(b.b)("inlineCode",{parentName:"p"},"session")," as a prop to the ",Object(b.b)("inlineCode",{parentName:"p"},"Profile")," component in the page. Otherwise, redirect to ",Object(b.b)("inlineCode",{parentName:"p"},"/login")," on the server-side. Notice there is not a loading skeleton in this example."),Object(b.b)("div",{className:"remark-code-title"},"pages/profile.js"),Object(b.b)("pre",{className:"language-jsx"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-jsx"}),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"export")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"default")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function-variable function"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token maybe-class-name"}),"Profile"))," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token parameter"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"{")," session ",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"}")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"<"),"p"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),">")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"session",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"user"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"name"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"</"),"p"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),">")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"export")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"async")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"function")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"getServerSideProps"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token parameter"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"{")," req",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),",")," res ",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"}")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// Get the user's session based on the request"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," session ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"await")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"getSession"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"req",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"if")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"!"),"session",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// If no user, redirect to login"),"\n    res",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"writeHead"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"307"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token maybe-class-name"}),"Location"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'/login'")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    res",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"end"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," props",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// If there is a user, return the current session"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," props",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," session ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(b.b)("p",null,"An advantage of this pattern is preventing a flash of unauthenticated content before redirecting. It's important to note fetching user data in ",Object(b.b)("inlineCode",{parentName:"p"},"getServerSideProps")," will block rendering until the request to your authentication provider resolves. To prevent creating a bottleneck and decreasing your TTFB (",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://web.dev/time-to-first-byte/"}),"Time to First Byte"),"), you should ensure your authentication lookup is fast. Otherwise, consider static generation."),Object(b.b)("p",null,"There is an ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/vercel/next.js/discussions/14890"}),"open RFC")," to improve redirecting inside ",Object(b.b)("inlineCode",{parentName:"p"},"getServerSideProps"),"."),Object(b.b)("h2",{id:"providers"},"Providers"),Object(b.b)("p",null,"Now that we've discussed authentication patterns, let's look at specific providers and explore how they're used with Next.js."),Object(b.b)("h3",{id:"firebase"},"Firebase"),Object(b.b)("p",null,"When using ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"/blog/nextjs-firebase-serverless"}),"Firebase Authentication"),", I recommend using the static generation pattern."),Object(b.b)("p",null,"It is possible to use the Firebase Client SDK to generate an ID token and forward it directly to Firebase's REST API on the server to log-in. However, requests to Firebase might take some time to resolve, depending on your user's location."),Object(b.b)("p",null,"Let's look an example creating a ",Object(b.b)("inlineCode",{parentName:"p"},"useUser")," hook. This hook allows you to fully control where you'll call ",Object(b.b)("inlineCode",{parentName:"p"},"signinWithGitHub"),", or any other authentication provider with Firebase."),Object(b.b)("pre",{className:"language-jsx"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-jsx"}),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"import")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token maybe-class-name"}),"React"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," useState",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," useEffect",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," useContext",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," createContext ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"from")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'react'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"import")," firebase ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"from")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'./firebase'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," authContext ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"createContext"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// You can wrap your _app.js with this provider"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"export")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"function")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token maybe-class-name"}),"AuthProvider")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token parameter"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"{")," children ",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"}")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," auth ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"useProvideAuth"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"<"),"authContext.Provider")," ",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token attr-name"}),"value"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token script language-javascript"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token script-punctuation punctuation"}),"="),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"{"),"auth",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"}")),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),">")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"children",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"</"),"authContext.Provider"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),">")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// Custom React hook to access the context"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"export")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function-variable function"}),"useAuth")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"useContext"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"authContext",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"function")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"useProvideAuth"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// Store the user in state"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"["),"user",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," setUser",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"]")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"useState"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword null nil"}),"null"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function-variable function"}),"signinWithGitHub")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," firebase\n      ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"auth"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),"\n      ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"signInWithPopup"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"new")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token class-name"}),"firebase",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"."),"auth",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"."),"GithubAuthProvider"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),"\n      ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"then"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token parameter"}),"response"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"setUser"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"response",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"user"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function-variable function"}),"signout")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," firebase\n      ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"auth"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),"\n      ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"signOut"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),"\n      ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"then"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"setUser"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token boolean"}),"false"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"useEffect"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," unsubscribe ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," firebase",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"auth"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"onAuthStateChanged"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"handleUser",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"unsubscribe"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"]"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    user",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n    signinWithGitHub",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n    signout\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(b.b)("p",null,"If you don't want to create the interface yourself, you can use ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/firebase/firebaseui-web"}),"FirebaseUI"),".\nFor more details, see the ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/vercel/next.js/tree/canary/examples/with-firebase-authentication"}),Object(b.b)("inlineCode",{parentName:"a"},"with-firebase-authentication")," example"),"."),Object(b.b)("h3",{id:"bring-your-own-database"},"Bring Your Own Database"),Object(b.b)("p",null,"If you have an existing database with user data, you'll likely want to utilize an open-source solution that's provider agnostic."),Object(b.b)("ul",null,Object(b.b)("li",{parentName:"ul"},"If you need email/password log-in, use ",Object(b.b)("inlineCode",{parentName:"li"},"next-iron-session"),"."),Object(b.b)("li",{parentName:"ul"},"If you need to persist session data on the server, use ",Object(b.b)("inlineCode",{parentName:"li"},"next-auth"),"."),Object(b.b)("li",{parentName:"ul"},"If you need to support social login (Google, Facebook, etc.), use ",Object(b.b)("inlineCode",{parentName:"li"},"next-auth"),"."),Object(b.b)("li",{parentName:"ul"},"If you want to use ",Object(b.b)("a",Object(n.a)({parentName:"li"},{href:"https://jwt.io/"}),"JWTs"),", use ",Object(b.b)("inlineCode",{parentName:"li"},"next-auth"),".")),Object(b.b)("p",null,"Both of these libraries support either authentication pattern."),Object(b.b)("ul",null,Object(b.b)("li",{parentName:"ul"},Object(b.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/vercel/next.js/tree/canary/examples/with-next-auth"}),"with-next-auth")),Object(b.b)("li",{parentName:"ul"},Object(b.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/vercel/next.js/tree/canary/examples/with-iron-session"}),"with-iron-session"))),Object(b.b)("h3",{id:"magic-passwordless"},"Magic (Passwordless)"),Object(b.b)("p",null,"Magic, which uses ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://magic.link/"}),"passwordless login"),", supports the static generation pattern. Similar to Firebase, a ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://w3c-ccg.github.io/did-primer/"}),"unique identifier")," has to be created on the client-side and then forwarded as a header to log-in."),Object(b.b)("pre",{className:"language-jsx"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-jsx"}),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," did ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"await")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"new")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token class-name"}),"Magic"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"\n  process",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"env"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token constant"}),"NEXT_PUBLIC_MAGIC_PUB_KEY"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"auth"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"loginWithMagicLink"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," email",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'your@email.com'")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," authRequest ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"await")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"fetch"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'/api/login'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  method",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'POST'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n  headers",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token maybe-class-name"}),"Authorization"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token template-string"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token template-punctuation string"}),"`"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token string"}),"Bearer "),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation-punctuation punctuation"}),"${"),"did",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation-punctuation punctuation"}),"}")),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token template-punctuation string"}),"`"))," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n")),Object(b.b)("p",null,"Then, we can use Magic's Node SDK to exchange the unique identifier for information about the user. Finally, we'll want to persist the user's session by creating a cookie. You can either ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/vercel/next.js/blob/canary/examples/with-magic/lib/auth-cookies.js"}),"write this logic yourself")," or use ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/vercel/next.js/tree/canary/examples/with-iron-session"}),"next-iron-session"),"."),Object(b.b)("div",{className:"remark-code-title"},"pages/api/login.js"),Object(b.b)("pre",{className:"language-jsx"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-jsx"}),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"import")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token maybe-class-name"}),"Magic")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"from")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'@magic-sdk/admin'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"let")," magic ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"new")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token class-name"}),"Magic"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"process",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"env"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token constant"}),"MAGIC_SECRET_KEY"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"export")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"default")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"async")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token parameter"}),"req",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),",")," res"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"if")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"req",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"method")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"!==")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'POST'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," res",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"status"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"405"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"end"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// Exchange the DID from Magic for some user data"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," did ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," magic",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"utils"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"parseAuthorizationHeader"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"req",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"headers"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"authorization"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," user ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"await")," magic",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"users"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"getMetadataByToken"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"did",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// Create a cookie to persist a user's session"),"\n\n  res",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"end"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n")),Object(b.b)("p",null,"For more details, see the ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/vercel/next.js/tree/canary/examples/with-magic"}),Object(b.b)("inlineCode",{parentName:"a"},"with-magic")," example"),"."),Object(b.b)("h3",{id:"auth0"},"Auth0"),Object(b.b)("p",null,"Auth0 can support both authentication patterns. You can also utilize ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://nextjs.org/docs/api-routes/introduction"}),"API routes")," for logging in/out and retrieving user information. For example, after initializing the ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"@auth0/nextjs-auth0"}),"Auth0 SDK"),", you can log-in by calling ",Object(b.b)("inlineCode",{parentName:"p"},"handleLogin"),"."),Object(b.b)("div",{className:"remark-code-title"},"pages/api/login.js"),Object(b.b)("pre",{className:"language-jsx"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-jsx"}),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"import")," auth0 ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"from")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'../../lib/auth0'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"export")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"default")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"async")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"function")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"login"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token parameter"}),"req",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),",")," res"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"try")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"await")," auth0",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"handleLogin"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"req",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," res",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"catch")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"error",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token console class-name"}),"console"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"error"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"error",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    res",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"status"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"error",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"status")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"||")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"500"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"end"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"error",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"message"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(b.b)("p",null,"Auth0 populates the session so you can utilize static generation or ",Object(b.b)("inlineCode",{parentName:"p"},"getServerSideProps")," for server-side rendering. Here's an example of the latter."),Object(b.b)("div",{className:"remark-code-title"},"pages/profile.js"),Object(b.b)("pre",{className:"language-jsx"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-jsx"}),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"import")," auth0 ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"from")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'../../lib/auth0'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"export")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"async")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"function")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"getServerSideProps"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token parameter"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"{")," req",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),",")," res ",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"}")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," session ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"await")," auth0",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"getSession"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"req",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"if")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"!"),"session ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"||")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"!"),"session",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"user"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    res",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"writeHead"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"307"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token maybe-class-name"}),"Location"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'/api/login'")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    res",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"end"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," props",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," props",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," user",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," session",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"user")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(b.b)("p",null,"For more details, see the ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/vercel/next.js/tree/canary/examples/auth0"}),Object(b.b)("inlineCode",{parentName:"a"},"auth0")," example"),"."),Object(b.b)("h2",{id:"frequently-asked-questions"},"Frequently Asked Questions"),Object(b.b)("h3",{id:"how-can-i-fetch-user-data-once-for-every-page-in-my-application"},"How Can I Fetch User Data Once for Every Page in My Application?"),Object(b.b)("p",null,"To fetch data once for your entire Next.js application, create a ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://nextjs.org/docs/advanced-features/custom-app"}),"custom ",Object(b.b)("inlineCode",{parentName:"a"},"App"))," and use ",Object(b.b)("inlineCode",{parentName:"p"},"getInitialProps"),".\nYou should only use this method if you have blocking data requirements for ",Object(b.b)("em",{parentName:"p"},"every single page")," in your application.\nThis will disable ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://nextjs.org/docs/advanced-features/automatic-static-optimization"}),"static optimization"),".\nThe Next.js team is ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/vercel/next.js/discussions/10949#discussioncomment-44898"}),"working to add support")," for ",Object(b.b)("inlineCode",{parentName:"p"},"getStaticProps")," inside ",Object(b.b)("inlineCode",{parentName:"p"},"_app.js"),"."),Object(b.b)("p",null,"Here's an example using a provider like Auth0."),Object(b.b)("div",{className:"remark-code-title"},"_app.js"),Object(b.b)("pre",{className:"language-jsx"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-jsx"}),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token maybe-class-name"}),"App"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method-variable function-variable method function property-access"}),"getInitialProps")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"async")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token parameter"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"{")," req",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),",")," res ",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"}")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// Only run on the server"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"if")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"typeof")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token dom variable"}),"window")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"===")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'undefined'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," session ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"await")," auth0",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"getSession"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"req",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"if")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"!"),"session ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"||")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"!"),"session",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"user"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      res",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"writeHead"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"307"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token maybe-class-name"}),"Location"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'/api/login'")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n      res",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"end"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n      ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," user",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," session",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"user")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n")),Object(b.b)("p",null,"If you require some pages to render as static HTML, you should use ",Object(b.b)("inlineCode",{parentName:"p"},"getServerSideProps"),"\nin every page requiring server-rendering. You can extract this logic to a shared function to improve code reuse."),Object(b.b)("div",{className:"remark-code-title"},"lib/auth.js"),Object(b.b)("pre",{className:"language-jsx"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-jsx"}),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"export")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function-variable function"}),"requirePageAuth")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token parameter"}),"inner"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"async")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token parameter"}),"context"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," session ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"await")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"getSession"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"context",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"req"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"if")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"!"),"session",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      context",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"res"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"writeHead"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"307"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token maybe-class-name"}),"Location"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'/login'")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n      context",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"res"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"end"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n      ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," props",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," inner ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"?")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"inner"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"context",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," auth",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," props",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," session ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n")),Object(b.b)("div",{className:"remark-code-title"},"pages/profile.js"),Object(b.b)("pre",{className:"language-jsx"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-jsx"}),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"export")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"default")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function-variable function"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token maybe-class-name"}),"Profile"))," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token parameter"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"{")," session ",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"}")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"<"),"p"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),">")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"session",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"user"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"name"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"</"),"p"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),">")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"export")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," getServerSideProps ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," requirePageAuth",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n")),Object(b.b)("h2",{id:"conclusion"},"Conclusion"),Object(b.b)("p",null,"That's it! Hopefully this helps demystify authentication with Next.js by providing tangible examples.\nFeel free to leave a comment below if I've missed anything."),Object(b.b)("blockquote",null,Object(b.b)("p",{parentName:"blockquote"},"Update: I'm working on adding a condensed version of this post to the ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/vercel/next.js/pull/16277"}),"Next.js documentation"),".")))}O.isMDXComponent=!0}},[["3BsH",1,2,0,3,4,5,6,7,8]]]);