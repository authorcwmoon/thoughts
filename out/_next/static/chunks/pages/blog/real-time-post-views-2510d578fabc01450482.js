_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[61],{"7zF6":function(e,a,t){"use strict";t.r(a),t.d(a,"frontMatter",(function(){return m})),t.d(a,"default",(function(){return O}));var n=t("wx14"),c=t("Ff2n"),s=t("q1tI"),o=t.n(s),b=t("7ljp"),p=t("ZDfL"),m=(o.a.createElement,{title:"Real-Time Blog Post Views With React and Firebase",publishedAt:"2019-08-21",summary:"Want more accurate page view counts? Learn how to create your own microservice for tracking real-time view counts using Firebase and then visualize those counts using React.",image:"/static/images/real-time-post-views/banner.jpg",wordCount:1408,readingTime:{text:"8 min read",minutes:7.03,time:421800,words:1406},__resourcePath:"blog/real-time-post-views.mdx",__scans:{},layout:"index"}),r={frontMatter:m},j=p.a;function O(e){var a=e.components,t=Object(c.a)(e,["components"]);return Object(b.b)(j,Object(n.a)({},r,t,{components:a,mdxType:"MDXLayout"}),Object(b.b)("p",null,Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/timqian/chart.xkcd"}),Object(b.b)("img",Object(n.a)({parentName:"a"},{src:"/static/images/real-time-post-views/chart.png",alt:"Blog Post Views"})))),Object(b.b)("p",null,"One metric for a website's success is the amount of traffic it receives.\nFor a blog, this translates to page views. Articles with lots of views indicate the content your readers care most about.\nThis helps drive future articles."),Object(b.b)("p",null,"Most people measure view counts via analytics (like ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://analytics.google.com/analytics/web/"}),"Google Analytics"),").\nHowever, with the rise of ad-blocking browser extensions, these counts are likely ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://moz.com/blog/analytics-black-holes"}),"~10% off")," (especially if your target market is tech).\nWhat if we could have better accuracy, better performance, and better privacy for our users?"),Object(b.b)("h2",{id:"table-of-contents"},"Table of Contents"),Object(b.b)("ol",null,Object(b.b)("li",{parentName:"ol"},Object(b.b)("a",Object(n.a)({parentName:"li"},{href:"#who-is-this-for"}),"Who Is This For?")),Object(b.b)("li",{parentName:"ol"},Object(b.b)("a",Object(n.a)({parentName:"li"},{href:"#technical-overview"}),"Technical Overview")),Object(b.b)("li",{parentName:"ol"},Object(b.b)("a",Object(n.a)({parentName:"li"},{href:"#setting-up-firebase"}),"Setting Up Firebase")),Object(b.b)("li",{parentName:"ol"},Object(b.b)("a",Object(n.a)({parentName:"li"},{href:"#creating-the-microservice"}),"Creating The Microservice")),Object(b.b)("li",{parentName:"ol"},Object(b.b)("a",Object(n.a)({parentName:"li"},{href:"#deploying-and-testing-view-counts"}),"Deploying and Testing View Counts")),Object(b.b)("li",{parentName:"ol"},Object(b.b)("a",Object(n.a)({parentName:"li"},{href:"#lazy-loading-firebase-client-side"}),"Lazy-Loading Firebase Client Side")),Object(b.b)("li",{parentName:"ol"},Object(b.b)("a",Object(n.a)({parentName:"li"},{href:"#real-time-view-count-updates"}),"Real-Time View Count Updates")),Object(b.b)("li",{parentName:"ol"},Object(b.b)("a",Object(n.a)({parentName:"li"},{href:"#conclusion"}),"Conclusion"))),Object(b.b)("h2",{id:"who-is-this-for"},"Who Is This for?"),Object(b.b)("p",null,"Anyone running their own blog, whether that's using\nvanilla React or a static-site generator like ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.gatsbyjs.com/"}),"Gatsby")," or ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://nextjs.org/features/static-exporting"}),"Next.js"),"."),Object(b.b)("h2",{id:"technical-overview"},"Technical Overview"),Object(b.b)("h3",{id:"objective"},"Objective"),Object(b.b)("p",null,"Display a real-time view count for a given blog post.\nThis should not block the page load and should log views asynchronously.\nThe client should automatically update when it receives a new count from the server."),Object(b.b)("h3",{id:"server"},"Server"),Object(b.b)("p",null,"To track views, we will be creating a serverless microservice with ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/zeit/micro"}),"Micro")," and a ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://firebase.google.com/docs/database"}),"Firebase Realtime Database"),".\nGiven an ID query parameter (",Object(b.b)("inlineCode",{parentName:"p"},"/?id=$id"),") our microservice should increment views for the corresponding post in Firebase.\nIt should also prevent abuse by logging IPs."),Object(b.b)("h3",{id:"client"},"Client"),Object(b.b)("p",null,"Our client application should ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://nextjs.org/learn/excel/lazy-loading-components"}),"lazy-load")," the ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://firebase.google.com/docs/reference/js"}),"Firebase JavaScript SDK")," on page load and subscribe to view counts.\nWhen it receives a new count, the counter should highlight and update."),Object(b.b)("p",null,"We can host and deploy this entire solution ",Object(b.b)("strong",{parentName:"p"},"for free")," using Firebase's ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://firebase.google.com/pricing/"}),"free tier")," and ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://vercel.com"}),"Vercel"),". Amazing."),Object(b.b)("h2",{id:"setting-up-firebase"},"Setting up Firebase"),Object(b.b)("ol",null,Object(b.b)("li",{parentName:"ol"},"If you do not have a Firebase account, create one first."),Object(b.b)("li",{parentName:"ol"},"Create a new project."),Object(b.b)("li",{parentName:"ol"},'Navigate to "Database" and click "Create Database".\n',Object(b.b)("img",Object(n.a)({parentName:"li"},{src:"/static/images/real-time-post-views/firebase/step1.png",alt:"Create Firebase Database"}))),Object(b.b)("li",{parentName:"ol"},"Start in test mode and click next.\n",Object(b.b)("img",Object(n.a)({parentName:"li"},{src:"/static/images/real-time-post-views/firebase/step2.png",alt:"Create Firebase Database"}))),Object(b.b)("li",{parentName:"ol"},"Choose your database location and click done.\n",Object(b.b)("img",Object(n.a)({parentName:"li"},{src:"/static/images/real-time-post-views/firebase/step3.png",alt:"Create Firebase Database"}))),Object(b.b)("li",{parentName:"ol"},'In the top left, click on "Project Settings".\n',Object(b.b)("img",Object(n.a)({parentName:"li"},{src:"/static/images/real-time-post-views/firebase/step4.png",alt:"Create Firebase Database"}))),Object(b.b)("li",{parentName:"ol"},'Navigate to "Service Accounts" tab and click "Generate new private key". Save the ',Object(b.b)("inlineCode",{parentName:"li"},".json")," file. You will need this later.\n",Object(b.b)("img",Object(n.a)({parentName:"li"},{src:"/static/images/real-time-post-views/firebase/step5.png",alt:"Create Firebase Database"})))),Object(b.b)("p",null,"We're finished! \ud83c\udf89 You have successfully set up a realtime database, as well as generated credentials for your microservice to connect to the database."),Object(b.b)("h2",{id:"creating-the-microservice"},"Creating the Microservice"),Object(b.b)("blockquote",null,Object(b.b)("p",{parentName:"blockquote"},"Update 2020: I've switched my microservice to an ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/leerob/leerob.io/blob/master/pages/api/increment-views.js"}),"API route")," inside my Next.js application. If you're using Next.js, I would recommend this approach.")),Object(b.b)("p",null,"This blog post was inspired by Guillermo Rauch's ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/rauchg/blog"}),"blog"),", where he open-sourced ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/rauchg/blog-views"}),"his code"),". I've updated some things but this is largely inspired by his work \ud83c\udf89"),Object(b.b)("p",null,"You can view the entire source code ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/leerob/blog-views"}),"here"),". I'll be explaining some key concepts for how the microservice works."),Object(b.b)("h3",{id:"connecting-to-firebase"},"Connecting to Firebase"),Object(b.b)("p",null,"Before we can log views, we need to connect to our Firebase Realtime Database.\nPlace your ",Object(b.b)("inlineCode",{parentName:"p"},"service-account.json")," in the root of the repo.\nThis file is inside ",Object(b.b)("inlineCode",{parentName:"p"},".gitignore")," so it won't be committed to GitHub. We can connect to the database using ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:""}),"firebase-admin"),". Make sure you update the ",Object(b.b)("inlineCode",{parentName:"p"},"databaseURL"),"."),Object(b.b)("pre",{className:"language-js"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-js"}),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," admin ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"require"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'firebase-admin'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," join ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"require"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'path'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," cert ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"join"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"__dirname",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'../service-account.json'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\nadmin",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"initializeApp"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  credential",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," admin",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"credential"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"cert"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"cert",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n  databaseURL",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'https://your-blog.firebaseio.com'"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\nmodule",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"exports")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," admin",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"database"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n")),Object(b.b)("h3",{id:"tracking-views"},"Tracking Views"),Object(b.b)("p",null,"To track a view, we need to look at the database for ",Object(b.b)("inlineCode",{parentName:"p"},"views -> id"),"."),Object(b.b)("pre",{className:"language-js"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-js"}),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," db ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"require"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'./db'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\nmodule",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method-variable function-variable method function property-access"}),"exports")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"function")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"incrementViews"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token parameter"}),"id"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," ref ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," db",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"ref"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'views'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"child"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"id",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," ref",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"transaction"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token parameter"}),"currentViews"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// if it has never been set it returns null"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"if")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"currentViews ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"===")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword null nil"}),"null"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," currentViews ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"0"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," currentViews ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"+")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"1"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n")),Object(b.b)("h3",{id:"putting-it-all-together"},"Putting It All Together"),Object(b.b)("p",null,"The entry point into the application sets CORS headers, checks for a valid request, parses the ",Object(b.b)("inlineCode",{parentName:"p"},"id")," query parameter, and increments the value for the given ",Object(b.b)("inlineCode",{parentName:"p"},"id"),". Make sure to update the URL for your blog."),Object(b.b)("pre",{className:"language-js"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-js"}),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," verify ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"require"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'./lib/verify'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," parse ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"require"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'url'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," increment ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"require"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'./lib/increment-views'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\nmodule",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method-variable function-variable method function property-access"}),"exports")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"async")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token parameter"}),"req",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),",")," res"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," orig ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," req",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"headers"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"origin"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"if")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token regex"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token regex-delimiter"}),"/"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token language-regex"}),"https:",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token escape"}),"\\/"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token escape"}),"\\/"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token group"}),"("),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token charclass"}),"."),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token quantifier"}),"*"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token special-escape escape"}),"\\."),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token group"}),")"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token quantifier"}),"?"),"leerob",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token special-escape escape"}),"\\."),"io"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token regex-delimiter"}),"/")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"test"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"orig",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    res",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"setHeader"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'Access-Control-Allow-Origin'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," orig",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    res",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"setHeader"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'Access-Control-Allow-Methods'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'GET'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// ensure no duplicate views"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"verify"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"req",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    query",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," id ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"parse"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"req",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"url"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token boolean"}),"true"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"if")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"!"),"id",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," err ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"new")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token class-name"}),"Error"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'Missing `id` parameter'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    err",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"statusCode")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"400"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"throw")," err",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," snapshot ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"await")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"increment"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"id",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," total",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," snapshot",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"val"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n")),Object(b.b)("h2",{id:"deploying-and-testing-view-counts"},"Deploying and Testing View Counts"),Object(b.b)("p",null,"After you've ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/leerob/blog-views"}),"cloned the repo")," and followed the steps above to substitute your values, run ",Object(b.b)("inlineCode",{parentName:"p"},"yarn dev")," to start the microservice."),Object(b.b)("p",null,"Using your favorite REST client or your browser, you can now hit ",Object(b.b)("inlineCode",{parentName:"p"},"http://localhost:3000?id=blog-post")," to log a view."),Object(b.b)("p",null,Object(b.b)("img",Object(n.a)({parentName:"p"},{src:"/static/images/real-time-post-views/microservice.jpg",alt:"Testing Microservice"}))),Object(b.b)("p",null,"We can confirm it was logged correctly by checking Firebase."),Object(b.b)("p",null,Object(b.b)("img",Object(n.a)({parentName:"p"},{src:"/static/images/real-time-post-views/testing-database.png",alt:"Testing Firebase"}))),Object(b.b)("h3",{id:"deployment-with-vercel"},"Deployment with Vercel"),Object(b.b)("p",null,"We can configure our microservice to deploy with ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://vercel.com"}),"Vercel")," through a ",Object(b.b)("inlineCode",{parentName:"p"},"vercel.json")," file.\nUpdate the ",Object(b.b)("inlineCode",{parentName:"p"},"name")," and ",Object(b.b)("inlineCode",{parentName:"p"},"alias")," to be unique for your microservice."),Object(b.b)("pre",{className:"language-json"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-json"}),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"version"'),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"2"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"name"'),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"your-blog-views"'),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"alias"'),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"your-blog-views"'),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),","),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"builds"'),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"["),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"src"'),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"index.js"'),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property"}),'"use"'),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),'"now-micro"')," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"]"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(b.b)("p",null,"After installing the ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://vercel.com/download"}),"Vercel CLI"),", you can deploy in ",Object(b.b)("em",{parentName:"p"},"one command")," \ud83d\ude80"),Object(b.b)("pre",{className:"language-bash"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"$ vc --prod\n")),Object(b.b)("p",null,"You should now be able to hit ",Object(b.b)("inlineCode",{parentName:"p"},"https://your-blog-views.now.sh/"),"."),Object(b.b)("h2",{id:"lazy-loading-firebase-client-side"},"Lazy-Loading Firebase Client Side"),Object(b.b)("p",null,"Firebase is a large module. In fact, it's larger than ",Object(b.b)("inlineCode",{parentName:"p"},"react"),", ",Object(b.b)("inlineCode",{parentName:"p"},"react-dom")," and ",Object(b.b)("inlineCode",{parentName:"p"},"next")," ",Object(b.b)("em",{parentName:"p"},"combined"),".\nWe only want to load the parts of Firebase we need (",Object(b.b)("inlineCode",{parentName:"p"},"firebase/app")," and ",Object(b.b)("inlineCode",{parentName:"p"},"firebase/database"),") and we don't want to block the page load."),Object(b.b)("p",null,"Let's lazy-load the Firebase JavaScript SDK."),Object(b.b)("pre",{className:"language-js"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-js"}),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"export")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"default")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"async")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"function")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"loadDb"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," firebase ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"await")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"import"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'firebase/app'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"await")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"import"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'firebase/database'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"try")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    firebase",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"initializeApp"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      databaseURL",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'https://your-blog.firebaseio.com'"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"catch")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"error",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),'/*\n     * We skip the "already exists" message which is\n     * not an actual error when we\'re hot-reloading.\n     */'),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"if")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"!"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token regex"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token regex-delimiter"}),"/"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token language-regex"}),"already exists"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token regex-delimiter"}),"/")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"test"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"error",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"message"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token console class-name"}),"console"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"error"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'Firebase initialization error'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," error",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"stack"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," firebase",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"database"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"ref"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'views'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(b.b)("h2",{id:"real-time-view-count-updates"},"Real-Time View Count Updates"),Object(b.b)("p",null,"Now that our microservice is deployed, we can instruct our client to asynchronously log a view when the page loads. We also need to subscribe to the view counts for the given blog post ID so the client updates every time the value changes."),Object(b.b)("p",null,"Let's create a ",Object(b.b)("inlineCode",{parentName:"p"},"<ViewCounter />")," component."),Object(b.b)("p",null,Object(b.b)("strong",{parentName:"p"},"Note"),": The ",Object(b.b)("inlineCode",{parentName:"p"},"<Views />")," component will be created next."),Object(b.b)("pre",{className:"language-jsx"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-jsx"}),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"import")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token maybe-class-name"}),"React"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," useState",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," useEffect ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"from")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'react'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"import")," loadDb ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"from")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'../lib/load-db'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"import")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token maybe-class-name"}),"Views")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"from")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'./views'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"function")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token maybe-class-name"}),"ViewCounter")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token parameter"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"{")," id ",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"}")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"["),"views",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," setViews",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"]")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"useState"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"''"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// Subscribe to view count updates"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"useEffect"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function-variable function"}),"onViews")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token parameter"}),"newViews"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"setViews"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"newViews",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"val"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"let")," db",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function-variable function"}),"fetchData")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"async")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      db ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"await")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"loadDb"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n      db",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"child"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"id",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"on"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'value'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," onViews",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"fetchData"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"function")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"cleanup"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      db",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"child"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"id",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token method function property-access"}),"off"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'value'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," onViews",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"["),"id",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"]"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token comment"}),"// Asynchronously log a view"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"useEffect"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function-variable function"}),"registerView")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>"),"\n      ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"fetch"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token template-string"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token template-punctuation string"}),"`"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token string"}),"https://your-blog-views.now.sh/?id="),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation-punctuation punctuation"}),"${"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token function"}),"encodeURIComponent"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"("),"id",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation-punctuation punctuation"}),"}")),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token template-punctuation string"}),"`")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"registerView"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"["),"id",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"]"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"<"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token class-name"}),"Views"))," ",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token attr-name"}),"views"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token script language-javascript"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token script-punctuation punctuation"}),"="),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"{"),"views",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"}"))," ",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"/>")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"export")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"default")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token maybe-class-name"}),"ViewCounter"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n")),Object(b.b)("p",null,"Now, let's look at ",Object(b.b)("inlineCode",{parentName:"p"},"<Views />"),".\nThis component should accept a prop ",Object(b.b)("inlineCode",{parentName:"p"},"views")," and display a formatted string that highlights when the value updates."),Object(b.b)("ul",null,Object(b.b)("li",{parentName:"ul"},"For styling, I'm using ",Object(b.b)("a",Object(n.a)({parentName:"li"},{href:"https://www.styled-components.com/"}),"styled-components"),"."),Object(b.b)("li",{parentName:"ul"},"For formatting, I'm using ",Object(b.b)("a",Object(n.a)({parentName:"li"},{href:"https://www.npmjs.com/package/comma-number"}),"comma-number"),".")),Object(b.b)("p",null,"First, let's look at the styles. A ",Object(b.b)("inlineCode",{parentName:"p"},"highlight")," prop controls a CSS animation."),Object(b.b)("pre",{className:"language-cs"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-cs"}),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," highlightBackgound ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," keyframes`\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"from")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        background",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"-"),"color",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," yellow",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n    to ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n        background",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"-"),"color",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," #fff",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n`",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," StyledViews ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," styled",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),"span`\n    font",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"-"),"size",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"0.9"),"em",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    text",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"-"),"transform",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," uppercase",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    letter",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"-"),"spacing",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"0.04"),"em",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n    $",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"props",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=>"),"\n        props",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),"highlight ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"&&"),"\n        css`\n            animation",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"-"),"name",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," $",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"highlightBackgound",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n            animation",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"-"),"duration",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),":")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"1"),"s",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n        `",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n`",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n")),Object(b.b)("p",null,"When a new ",Object(b.b)("inlineCode",{parentName:"p"},"views")," prop is passed to the component, it sets the highlight state to ",Object(b.b)("inlineCode",{parentName:"p"},"true"),".\nAfter 2 seconds, it resets the highlight state."),Object(b.b)("pre",{className:"language-jsx"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-jsx"}),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"import")," format ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"from")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'comma-number'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"import")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token maybe-class-name"}),"React"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," useState",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," useEffect ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"from")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'react'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"import")," styled",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{")," css",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," keyframes ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"from")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token string"}),"'styled-components'"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"function")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token maybe-class-name"}),"Views")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token parameter"}),"props"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"["),"highlight",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," setHighlight",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"]")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"useState"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token boolean"}),"false"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"useEffect"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"if")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"props",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"views"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"setHighlight"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token boolean"}),"true"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"setTimeout"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token arrow operator"}),"=>")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token function"}),"setHighlight"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token boolean"}),"false"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token number"}),"2000"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),",")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"["),"props",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token property-access"}),"views"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"]"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"const")," formattedViews ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token operator"}),"=")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token template-string"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token template-punctuation string"}),"`"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation-punctuation punctuation"}),"${"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token function"}),"format"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"("),"props",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token property-access"}),"views"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation-punctuation punctuation"}),"}")),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token string"})," views"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token template-punctuation string"}),"`")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword"}),"return")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"("),"\n    ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"<"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token class-name"}),"Container")),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),">")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token plain-text"}),"\n      "),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"<"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token class-name"}),"StyledViews"))," ",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token attr-name"}),"highlight"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token script language-javascript"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token script-punctuation punctuation"}),"="),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"{"),"highlight",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"}")),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),">")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"{"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token template-string"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token template-punctuation string"}),"`"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token string"})," - "),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation-punctuation punctuation"}),"${"),"\n        props",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"."),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token property-access"}),"views")," ",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token operator"}),"&&")," formattedViews\n      ",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token interpolation-punctuation punctuation"}),"}")),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token template-punctuation string"}),"`")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"</"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token class-name"}),"StyledViews")),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),">")),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token plain-text"}),"\n    "),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"</"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token class-name"}),"Container")),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),">")),"\n  ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),")"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"export")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token keyword module"}),"default")," ",Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token maybe-class-name"}),"Views"),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token punctuation"}),";"),"\n")),Object(b.b)("p",null,"Finally, we can consume the view counter in our blog post and pass in the ID."),Object(b.b)("pre",{className:"language-jsx"},Object(b.b)("code",Object(n.a)({parentName:"pre"},{className:"language-jsx"}),Object(b.b)("span",Object(n.a)({parentName:"code"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token tag"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"<"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token class-name"}),"ViewCounter"))," ",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token attr-name"}),"id"),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token attr-value"}),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"="),Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),'"'),"post-id",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),'"'))," ",Object(b.b)("span",Object(n.a)({parentName:"span"},{className:"token punctuation"}),"/>")),"\n")),Object(b.b)("p",null,"You can see a completed client-side example by checking out ",Object(b.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/leerob/leerob.io"}),"this blog post's source code"),"."),Object(b.b)("h2",{id:"conclusion"},"Conclusion"),Object(b.b)("p",null,"It works! \ud83c\udf89"),Object(b.b)("p",null,Object(b.b)("img",Object(n.a)({parentName:"p"},{src:"/static/images/real-time-post-views/example.gif",alt:"Blog Post Views Example Gif"}))),Object(b.b)("p",null,"I was able to migrate my page views from Google Analytics into Firebase via their web interface."),Object(b.b)("p",null,Object(b.b)("img",Object(n.a)({parentName:"p"},{src:"/static/images/real-time-post-views/blog-post-views.png",alt:"Blog Post Views"}))),Object(b.b)("p",null,Object(b.b)("strong",{parentName:"p"},"Note"),": If your site receives a lot of traffic, you'll need to upgrade from the Spark plan (free) to Blaze (pay-as-you-go).\nOn Spark, you can only have 100 simultaneous connections. With Blaze, you can have 100k."),Object(b.b)("p",null,Object(b.b)("img",Object(n.a)({parentName:"p"},{src:"/static/images/real-time-post-views/db-usage.png",alt:"Database Usage"}))))}O.isMDXComponent=!0},Ags5:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/real-time-post-views",function(){return t("7zF6")}])}},[["Ags5",1,2,0,3,4,5,6,7,8]]]);